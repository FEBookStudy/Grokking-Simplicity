## Chapter 4. 액션에서 계산 뺴내기

테스트하기 쉽고 재사용 하기 좋은 코드를 만들기 위해 리팩토링 하는 방법을 살펴볼 것이다.

우선 간과하면 안되는 것은 액션은 코드 전체로 퍼진다는 것이다.
합수에는 입력과 출력이 존재한다.

입력은 함수가 계산을 하기 위한 외부 정보이고
출력은 함수 밖을 나오는 정보나 어떠한 동작이다.

우리가 함수를 부르는 이유는 어떠한 결과가 필요하기 때문이다.
그리고 원하는 결과를 얻으려면 입력이 필요하다.

액션에서 계산을 빼내는 과정에서 우리가 인지해야할 점은 다음과 같다.

**입력과 출력은 명시적이거나 암묵적일 수 있다.**

인자는 명시적인 입력이다.
그리고 리턴값은 명시적인 출력이다.

**하지만 암묵적으로 함수로 들어가거나 나오는 정보도 있다.**
함수에 암묵적 입력과 출력이 있으면 액션이 된다.
이 말을 다시 풀어서 말하면,
함수에서 암묵적 입력과 출력을 없애면 계산이 된다.
암묵적 입력은 함수의 인자로 바꾸고, 암묵적 출력은 함수의 리턴값으로 바꾸면 된다.

그리고 함수형 프로그래밍에서는 이러한 암묵적 입력과 출력을 **부수 효과**라고 부른다.
부수효과는 함수가 하려고 하는 주요 기능(리턴값을 계산하는 일)이 아니다.

정리해보자.

1. 명시적 입력
   - 인자
2. 암묵적 입력
   - 인자 외 다른 입력
3. 명시적 출력
   - 리턴값
4. 암묵적 출력
   - 리턴값 외 다른 출력

그럼 암묵적 입력과 출력을 없애는 연습을 해보자.
예를 들면, 다음과 같은 일들을 할 수 있다.

1. DOM 업데이트와 비즈니스 규칙을 분리한다.
   DOM을 업데이트하는 일은 함수에서 어떤 정보가 나오는 것이기 때문에 출력이다.
   하지만 리턴값이 아니기 때문에 암묵적 출력이다.
   다만 사용자가 정보를 볼 수 있어야 하기 때문에 DOM 업데이트는 어디선가 해야 한다.
   따라서 이를 분리하자.
2. 전역변수가 없어야 한다.
   전역변수를 읽는 것은 암묵적 입력이고 바꾸는 것은 암묵적 출력이다.
   암묵적 입력은 인자로 바꾸고 암묵적 출력은 리턴값으로 바꾸면 된다.
3. DOM을 사용할 수 있는 곳에서 실행된다고 가정하지 않는다.
   우리가 만든 함수는 DOM 조작을 할 수 있다고 가정하고 만들어진것 일 수 있다. 하지만 이를 재사용하려고 하는 다른 팀에서는 DOM 조작은 하지 못한다면?
   DOM을 직접 쓰거나 조작하는 행위는 암묵적 출력이다. 암묵적 출력은 함수의 리턴값으로 바꿀 수 있다.
4. 함수가 결괏값을 리턴해야 한다.
   즉 암묵적인 출력 대신 명시적인 출력을 사용하자는 것이다.

이러한 예시들을 결국 함수형 프로그래밍에서 암묵적 입출력을 명시적 입출력으로 바꾸는 과정을 얘기하는 것이고, 이는 액션에서 계산을 빼내는 과정이라고 말한다.

액션에서 계산을 빼내는 과정은 다음과 같다.
먼저 계산에 해당하는 코드를 분리한다.
그리고 입력값은 인자로 출력값은 리턴값으로 바꾸어 나간다.

리팩토링이란 코드를 고치면서 동작은 그대로 유지하는 것을 말한다.

일시적으로 이러한 액션에서 계산을 빼내는 과정에서
코드의 양이 더 많아진다고 생각할 수 있다. 하지만 이는 올바르지 않은 접근이다. 숲을 바라보는 관점에서 생각해보면 우리는 액션에서 계산을 빼냄으로써 이미 코드를 테스트하기 쉬워졌고 재사용하기 좋아졌다.
즉 다른 부서에서도 이러한 함수를 쉽게 가져다 쓸 수 있으며
테스트 코드가 더욱 짧아졌다.
그리고 이것이 끝이 아니다. 점점 더 많은 좋은 점들을 발견할 수 있을 것이다.

> Q. 함수형 프로그래밍에서는 모든 것이 불변값이어야한다?
>
> 불변값은 생성된 다음에 바뀌면 안되는 값이다. 하지만 생성할 때는 초기화가 필요하다. 만약 초깃값이 있어야 하는 배열이 필요하고 이후에 바꾸지 않는다고 해도 초깃값을 넣기 위해 시작 부분에 값을 배열에 넣어줘야 한다.
> 지역변수를 변경하는 곳은 나중에 초기화할 값으로 새로 생성한다. 지역변수이기 때문에 함수 밖에서는 접글할 수 없다. 그리고 초기화가 끝났다면 그 값은 리턴해야한다. 이처럼 값이 바뀌지 않으려면 원칙이 필요한데 이에 대한 자세한 내용은 곧 알아볼 것이다.

### 계산 추출을 단계별로 알아보기

1. **계산 코드를 찾아 빼낸다.**
   <br />
   빼낼 코드를 찾는다. 코드를 추출해 새로운 함수를 만들어 리팩토링한다. 새 함수에 인자가 필요하다면 추가한다. 원래 코드에서 빼낸 부분에 새 함수를 부르도록 바꾼다.
2. **새 함수에 암묵적 입력과 출력을 찾는다.**
   <br />
   새 함수에 암묵적 입력과 출력을 찾는다. 암묵적 입력은 함수를 부르는 동안 결과에 영향을 줄 수 있는 것을 말한다. 암묵적 출력은 함수 호출의 결과로 영향을 받는 것을 말한다. 함수 인자를 포함해 함수 밖에 있는 변수를 읽거나 데이터베이스에서 값을 가져오는 것은 입력이다. 리턴값을 포함해 전역변수를 바꾸거나 공유 객체를 바꾸거나, 웹 요청을 보내는 것을 출력이다.
3. **암묵적 입력은 인자로 암묵적 출력은 리턴값으로 바꾼다.**
   <br />
   한번에 하나씩 입력은 인자로 출력은 리턴값으로 바꾼다. 새로운 리턴값이 생겼다면 호출하는 코드에서 함수의 결과를 변수에 할당해야 할 수도 있다.
   여기서 인자와 리턴값은 바뀌진 않는 불변값이라는 것이 중요하다. 리턴값이 나중에 바뀐다면 암묵적 출력이다. 또 인자로 받은 값이 바뀔 수 있다면 암묵적 입력이다. 앞으로 불변 데이터에 대해 다루면서 이런 것을 어떻게 강제할 수 있는지도 배울 것이다.

### 정리

- 액션은 암묵적인 입력 또는 출력을 가지고 있다.
- 계산의 정의에 따르면 계산은 암묵적인 입력이나 출력이 없어야 한다.
- 공유 변수(전역변수 같은)는 일반적으로 암묵적 입력 또는 출력이 된다.
- 암묵적 입력은 인자로 바꿀 수 있다.
- 암묵적 출력은 리턴값으로 바꿀 수 있다.
- 함수형 원칙을 적용하면 액션은 줄어들고 계산은 늘어난다.

더 좋은 코드를 만들기 위해 액션에서 계산을 추출해봤다.
하지만 어떤 경우에는 빼낼 계산이 없을지도 모른다. 그러면 모든 것이 액션인 것인데, 액션을 없앨 수 없는 상황애서 코드를 개선하려면 어떻게 해야할까?
