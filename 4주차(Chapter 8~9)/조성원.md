# 8. 계층형 설계 Ⅰ

> [!IMPORTANT]  
> **소프트웨어 설계란 무엇입니까?**  
> 코드를 만들고, 테스트하고, 유지보수하기 쉬운 프로그래밍 방법을 선택하기 위해 미적 감각을 사용하는 것

## 계층형 설계란 무엇인가요?

- 소프트웨어를 계층으로 구성하는 기술
  - 각 계층에 있는 함수는 바로 아래 계층에 있는 함수를 이용해 정의

&nbsp;

## 패턴 1: 직접 구현

### 저수준의 코드는 추출해야 할 가능성이 높다.

- 함수를 추출하면 더 일반적인 함수로 만들 수 있다.
- 일반적인 함수가 많을수록 재사용하기 좋다.

&nbsp;

### 호출 그래프를 만들어 함수 호출을 시각화하기

- 서로 다른 추상화 단계에 있는 기능을 사용하면 코드가 명확하지 않아 읽기 어렵다.
- 같은 계층에 있는 함수는 같은 목적을 가져야 한다.
  - 어떤 계층에 있는 함수를 읽거나 고칠 때 낮은 수준의 구체적인 내용은 신경 쓰지 않아도 된다.
- 다이어그램은 함수가 호출하는 것을 있는 그대로 표현한 것으로 함수를 어떤 계층에 놓을지 바로 알 수 있다.

&nbsp;

### 3단계 줌 레벨

1. 전역 줌 레벨 - 그래프 전체 중 필요한 부분을 살펴볼 수 있는 기본 줌 레벨
   - 계층 사이에 상호 관계를 포함해서 모든 문제 영역을 살펴볼 수 있다.
2. 계층 줌 레벨 - 한 계층과 연결된 바로 아래 계층을 볼 수 있는 줌 레벨
   - 계층이 어떻게 구현되어 있는지 알 수 있다.
3. 함수 줌 레벨 - 함수 하나와 바로 연결된 함수들을 볼 수 있는 줌 레벨
   - 함수 구현의 문제를 찾을 수 있다.

> [!TIP]  
> 직접 구현 패턴을 적용하면 모든 화살표가 같은 길이, 즉 같은 하위 계층의 함수를 사용해야 한다.  
> 가장 일반적인 방법은 중간 계층에 함수를 두어 긴 화살표를 줄이는 것.

&nbsp;

# 9. 계층형 설계 Ⅱ

## 패턴 2: 추상화 벽

- 팀 간 책임을 명확하게 나누는 것

&nbsp;

### 추상화 벽으로 구현을 감춥니다.

- 추상화 벽(abstraction barrier): 세부 구현을 감춘 함수로 이루어진 계층
  - 추상화 벽에 있는 함수를 사용할 때는 구현을 전혀 몰라도 함수를 쓸 수 있다.
- 추상화 벽을 가로지르는 화살표가 없어야 한다.
  - 추상화 벽 너머의 함수를 호출한다면 신경 쓰지 않아야 할 세부적인 구현을 사용하고 있는 것
  - 추상화 벽에 새로운 함수를 만들어 해결할 수 있다.

> [!TIP]  
> **세부적인 것을 감추는 것은 대칭적입니다.**  
> 추상화 벽을 사용하면 다른 팀에서 세부 구현을 신경 쓰지 않아도 된다. 신경쓰지 않아도 된다는 것은 대칭적이다.
> 추상화 벽을 만든 개발팀은 추상화 벽에 있는 함수를 사용하는 팀의 코드를 신경쓰지 않아도 된다. 두 팀 모두 독립적으로 일할 수 있게 된다.

&nbsp;

### 추상화 벽은 언제 사용하면 좋을까요?

1. 쉽게 구현을 바꾸기 위해
2. 코드를 읽고 쓰기 쉽게 만들기 위해
3. 팀 간에 조율해야 할 것을 줄이기 위해
4. 주어진 문제에 집중하기 위해

&nbsp;

## 패턴 3: 작은 인터페이스

- 새로운 코드를 추가할 위치에 관한 패턴
- 인터페이스를 최소화하면 하위 계층에 불필요한 기능이 쓸데없이 커지는 것을 막을 수 있다.

&nbsp;

### 새로운 기능을 추가하기 위한 두 가지 방법

1. 추상화 벽에 만들기
   - 팀 간 책임이 불분명해 질 수 있다.
     - 추상화 벽을 개발하는 팀에서 추상화 벽을 사용하는 팀의 코드를 관리해야 한다.
     - 추상화 벽을 사용하는 팀에서 코드를 바꾸고 싶을 때 개발팀에 이야기해야 한다.
   - 변경이 생긴다면 팀 사이의 계약에 사용하는 용어를 서로 맞춰야 하므로 시간이 많이 든다.
     - 더 많은 코드를 이해하고 더 많이 신경 써야 한다.
2. 추상화 벽 위에 만들기
   - 더 직접 구현에 가깝다.
   - 새로운 기능을 만들 때 하위 계층에 기능을 추가하거나 고치는 것보다 상위 계층에 만드는 것이 작은 인터페이스라고 할 수 있다.

&nbsp;

### 추상화 벽을 작게 만들어야 하는 이유

1. 추상화 벽에 코드가 많을수록 구현이 변경되었을 때 고쳐야 할 것이 많다.
2. 추상화 벽에 있는 코드는 낮은 수준의 코드이기 때문에 더 많은 버그가 있을 수 있다.
3. 낮은 수준의 코드는 이해하기 더 어렵다.
4. 추상화 벽에 코드가 많을수록 팀 간 조율해야 할 것도 많아진다.
5. 추상화 벽에 인터페이스가 많으면 알아야 할 것이 많아 사용하기 어렵다.

&nbsp;

## 패턴 4: 편리한 계층

- 작업하는 코드가 편리하다고 느낀다면 설계는 멈춰도 된다.
- 구체적인 것을 너무 많이 알아야 하거나, 코드가 지저분하다고 느껴진다면 다시 패턴을 적용해야 한다.
- 어떤 코드도 이상적인 모습에 도달할 수 없기 때문에 언제나 설계와 새로운 기능의 필요성 사이 어느 지점에 머물게 된다.

&nbsp;

## 그래프가 코드에 대해 알려주는 것

- 호출 그래프에서 함수 이름을 없애면 구조에 대한 추상적인 모습을 볼 수 있다.
  - 호출 그래프의 구조는 세 가지 중요한 비기능적 요구사항을 꾸밈없이 보여준다.

1. 유지보수성(maintainability): 요구 사항이 바뀌었을 때 가장 쉽게 고칠 수 있는 코드는 어떤 코드인지
2. 테스트성(testability): 어떤 것을 테스트하는 것이 가장 중요한지
3. 재사용성(reusability): 어던 함수가 재사용하기 좋은지

&nbsp;

### 그래프의 가장 위에 있는 코드가 고치기 가장 쉽습니다.

- 코드를 적절한 위치에 두면 유지보수 비용을 많이 줄일 수 있다.
- 가장 위에 있는 함수는 아무 곳에서도 호출하는 곳이 없기 때문에 바꿀 때 고민하지 않아도 된다.
  - 다른 코드에 영향을 주지 않고 변경할 수 있다.
- 시간이 지나도 변하지 않는 코드는 가장 아래 계층에 있어야 한다.
- 비즈니스 규칙처럼 자주 바뀌는 요구사항 코드는 그래프 위에 있는 것이 좋다.

> [!TIP]  
> 자주 바뀌는 코드는 그래프 위에 있을수록 쉽게 일할 수 있다.  
> 하지만 바뀌는 것이 많은 "가장 높은 곳"은 적게 유지하는 것이 좋다.

&nbsp;

### 아래에 있는 코드는 테스트가 중요합니다.

- 모든 코드를 테스트하는 것은 현실적이지 않다.
- 위에 있는 코드는 자주 바뀌기 때문에 테스트도 수명이 짧다.
- 패턴을 사용하면 테스트 가능성에 맞춰 코드를 계층화할 수 있다.
  - 하위 계층으로 코드를 추출하거나 상위 계층에 함수를 만드는 일은 테스트의 가치를 결정
    - 위쪽으로 많이 연결된 함수를 테스트하는 것이 더 가치가 있다.

&nbsp;

### 아래에 있는 코드가 재사용하기 더 좋습니다.

- 아래쪽으로 가리키는 화살표가 많은 함수는 재사용하기 어렵다.
