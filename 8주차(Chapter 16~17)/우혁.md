## Chapter 16. 타임라인 사이에 자원 공유하기

> 자원을 안전하게 공유하기 위해 **동시성 기본형**이라는 재사용 가능한 코드를 만드는 방법

> [!TIP]
> 동시성 기본형(concurrency primitive)
>
> - 자원을 안전하게 공유할 수 있는 재사용 가능한 코드를 말한다.

큐(queue)는 자료구조지만, 타임라인 조율에 사용한다면 **동시성 기본형**이라고 부른다.

- 순서 보장: 이벤트가 추가된 순서대로 실행된다.
- 동기적 실행: 각 이벤트는 동기적으로 처리되어 작업 간 간섭을 방지한다.

큐를 사용함으로써 얻을 수 있는 이점

- 경쟁 상태(race condition) 방지: 여러 타임라인이 동시에 같은 자원에 접근하는 것을 방지한다.
- 일관성 유지: 작업들이 순차적으로 실행되어 데이터의 일관성을 유지할 수 있다.
- 디버깅 용이: 작업의 실행 순서가 예측 가능해져 디버깅하기 쉽다

## Chapter 17. 타임라인 조율하기

- 순차적 실행: 한 액션이 완료된 후 다음 액션을 실행하는 방식
- 병렬 실행: 여러 액션을 동시에 시작하고 모두 완료될 때까지 기다리는 방식

### 암묵적 시간 모델 vs 명시적 시간 모델

자바스크립트의 기본 시간 모델(암묵적 시간 모델)

1. 순차적 구문은 순서대로 실행된다.
2. 두 타임라인에 있는 단계는 왼쪽 먼저 실행되거나, 오른쪽 먼저 실행될 수 있다.
3. 비동기 이벤트는 새로운 타임라인에서 실행된다.
4. 액션은 호출할 때마다 실행된다.

> 간단한 프로그램에서 암묵적 시간 모델은 좋다. 하지만 실행 방식을 바꾸지 못한다.
>
> 사실 암묵적 시간 모델의 실행 방식이 앱에서 필요한 실행 방식과 딱 맞을 일은 거의 없다.
>
> 그래서 함수형 개발자는 필요한 실행 방식에 가깝게 새로운 시간 모델을 만든다.

명시적 시간 모델(함수형 개발자가 필요에 따라 만드는 모델)

- Queue: 큐에 추가된 항목은 독립적으로 하나의 타임라인에서 처리된다.
- Cut: 모든 타임라인이 완료되면 콜백을 불러 새로운 타임라인을 시작한다.
  - `Promise.all()`: 여러 프로미스를 병렬로 실행
  - `Promise.race()`: 여러 프로미스 중 가장 먼저 완료되는 것을 사용
- JustOnce: JustOnce로 감싼 액션은 여러 번 불러도 한 번만 실행된다.
- DroppingQueue: Queue와 비슷하지만 항목이 빠르게 늘어나면 작업을 건너뛴다.

새로운 시간 모델은 해결하려고 하는 문제를 푸는데 도움이 된다.

요청한 순서대로 응답이 도착하면 문제 없지만 이것은 보장할 수 없다.

두 타임라인이 협력할 수 잇는 동시성 기본형을 만들어 항상 같은 결과를 얻을 수 있게 한다.
