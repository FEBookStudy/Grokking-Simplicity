## 일급 함수 I, II

이번 챕터에서는 코드의 냄새와 중복을 없애 추상화를 잘할 수 있는 리팩터링 방식 두 개를 소개한다.

> [!TIP]
> 코드의 냄새(Code Smell)
>
> - 더 큰 문제를 가져올 수 있는 코드

코드의 냄새는 일급 값으로 바꾸면 표현력이 좋아진다.

- 함수 본문에서 사용하는 값이 함수 이름에 나타난다면 `함수 이름에 있는 암묵적 인자`는 코드의 냄새가 된다.

```tsx
// 이런건가...?
const getUserName = async () => {
  const userName = await 유저네임가져오기();
};
```

- 거의 똑같이 구현된 함수가 있다.
- 함수 이름이 구현에 잇는 다른 부분을 가리킨다.

### 1. 암묵적 인자를 드러내기

- 암묵적 인자가 일급 값이 되도록 함수에 인자를 추가한다.

→ 잠재적 중복을 없애고 코드의 목적을 더 잘 표현할 수 있다.

```tsx
1. 함수 이름에 있는 암묵적 인자 확인
2. 명시적인 인자 추가하기
3. 함수 본문에 하드 코딩된 값을 새로운 인자로 바꾸기
4. 함수를 호출하는 곳 고치기
```

### 함수 이름에 있는 암묵적 인자

- 필드를 결정하는 문자열이 함수 이름에 있다.
- 함수 이름에 있는 일부가 인자처럼 동작한다.
- 값을 명시적으로 전달하지 않고 함수 이름의 일부로 전달하고 있다.

```tsx
function setPriceByName(cart, name, price){
	var item = cart[name];
	var newItem = ObjectSet(item, 'price', price);
	var newCart = ObjectSet(cart 'name', newItem);
	return newCart;
}

function setShippingByName(cart, name, ship){
	var item = cart[name];
	var newItem = ObjectSet(item, 'shipping', price);
	var newCart = ObjectSet(cart 'name', newItem);
	return newCart;
}
```

→ 암묵적 인자를 드러내어 범용적인 함수로 리팩터링하기

```tsx
function setFieldByName(cart, name, field. value)
```

### 일급인 것과 일급이 아닌 것을 구분하기

- 대부분의 언어가 일급이 아닌 것을 가지고 있다.
- 중요한건 일급이 아닌 것을 일급으로 바꾸는 방법

> [!TIP]
> 자바스크립트에서 일급이 아닌 것
>
> - 수식 연산자
> - 반복문
> - 조건문
> - try/catch 블록

자바스크립트에서 함수명의 일부를 값처럼 쓸 수 없는 방법이 없다.

그래서 함수형의 일부를 인자로 바꿔 일급으로 만든다.

<aside>
💡

일급으로 바꾸는 기술은 함수형 프로그래밍에서 중요하다.

이 기술을 시작으로 함수형 프로그래밍 패턴의 세련된 기술을 더 많이 알 수 있다.

</aside>

### 필드명을 문자열로 사용하면 휴먼에러가 발생할 수 있다.

- 문제를 해결하기 위해 `컴파일 타임에 검사`, `런타임에 검사` 하는 두 가지 방법이 있다.

컴파일 타임에 검사하는 방법은 타입스크립트와 같은 것을 사용할 수 있다.

런타임에 검사하는 방법은 필드명이 올바른지 확인하는 코드를 추가하는 것이다.

### 2. 함수 본문을 콜백으로 바꾸기

- 함수 본문에 어떤 부분(비슷한 함수에 있는 서로 다른 부분)을 콜백으로 바꾼다.

→ 이렇게 하면 일급 함수로 어떤 함수에 동작을 전달할 수 있다.

```tsx
1. 함수 본문에서 바꿀 부분을 앞부분과 뒷부분을 확인
2. 리팩터링 할 코드를 함수로 빼낸다.
3. 빼낸 함수의 인자로 넘길 부분을 또 다른 함수로 빼낸다.
```

```tsx
function withLoggin(fn) {
  try {
    fn(); // 콜백 함수
  } catch (error) {
    logToSnapErrors(error);
  }
}

withLogging(() => saveUserData(user));
```

### 정리하기

- 함수를 범용적으로 사용할 수 있을 지 체크해보기
- 중복되는 부분을 추상화 + 콜백 함수를 통해 해결해보기
- 고차함수 잘 쓰면 좋을 것 같지만, 너무 남용하면 코드의 흐름을 파악하기 어렵고 복잡할 것 같다.
